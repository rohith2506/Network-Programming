#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>
#include <fcntl.h>
#include <sys/msg.h>
#include <sys/ipc.h>

struct msg{
  long type;
  char buf[30];
  int i;
};

struct msg mg;

int main(int argc,char *argv[]){
      int key1=ftok("in11",345);
      int msgid=msgget(key1,IPC_CREAT | 0666);
      if(msgid==-1){
	perror("File Error\n");
	exit(1);
      }
      else{
	int pid=fork();
	if(pid>0){
	  while(1){
	  msgrcv(msgid,&mg,sizeof(struct msg)-sizeof(long),20,0);
	  printf("client 1 message is %s\n",mg.buf);
	  }
	}
	else{
	  while(1){
	  scanf("%s",mg.buf);
	  mg.type=100;
	  mg.i=20;
	  msgsnd(msgid,&mg,sizeof(struct msg)-sizeof(long),0);
	  }
	}
      }
     return 0;
}
	
  